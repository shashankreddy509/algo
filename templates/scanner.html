{% extends "base.html" %}

{% block title %}Scanner - Fyers Trading{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="card-title mb-0">
                    <i class="fas fa-search me-2"></i>Stock Scanner
                </h4>
                <p class="mb-0 mt-2">Find stocks based on technical and fundamental criteria</p>
            </div>
        </div>
    </div>
</div>

<!-- Scanner Filters -->
<div class="row">
    <div class="col-lg-3 mb-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-filter me-2"></i>Filters
                </h5>
            </div>
            <div class="card-body">
                <form id="scannerForm">
                    <!-- Market Segment -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Market Segment</label>
                        <select class="form-select" id="segment">
                            <option value="NSE">NSE</option>
                            <option value="BSE">BSE</option>
                            <option value="MCX">MCX</option>
                        </select>
                    </div>

                    <!-- Price Range -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Price Range</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" class="form-control" id="minPrice" placeholder="Min ₹" min="0" step="0.01">
                            </div>
                            <div class="col-6">
                                <input type="number" class="form-control" id="maxPrice" placeholder="Max ₹" min="0" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Volume -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Min Volume</label>
                        <input type="number" class="form-control" id="minVolume" placeholder="Min Volume" min="0">
                    </div>

                    <!-- Market Cap -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Market Cap</label>
                        <select class="form-select" id="marketCap">
                            <option value="">All</option>
                            <option value="large">Large Cap (>20,000 Cr)</option>
                            <option value="mid">Mid Cap (5,000-20,000 Cr)</option>
                            <option value="small">Small Cap (<5,000 Cr)</option>
                        </select>
                    </div>

                    <!-- Technical Indicators -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">Technical Patterns</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="bullishPattern">
                            <label class="form-check-label" for="bullishPattern">
                                Bullish Patterns
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="bearishPattern">
                            <label class="form-check-label" for="bearishPattern">
                                Bearish Patterns
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="breakoutPattern">
                            <label class="form-check-label" for="breakoutPattern">
                                Breakout Patterns
                            </label>
                        </div>
                    </div>

                    <!-- RSI Range -->
                    <div class="mb-3">
                        <label class="form-label fw-bold">RSI Range</label>
                        <div class="row">
                            <div class="col-6">
                                <input type="number" class="form-control" id="minRSI" placeholder="Min RSI" min="0" max="100">
                            </div>
                            <div class="col-6">
                                <input type="number" class="form-control" id="maxRSI" placeholder="Max RSI" min="0" max="100">
                            </div>
                        </div>
                    </div>

                    <!-- One Hour Setup Strategy -->
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="oneHourSetup">
                            <label class="form-check-label fw-bold text-primary" for="oneHourSetup">
                                <i class="fas fa-clock me-1"></i>One Hour Setup Strategy
                            </label>
                        </div>
                        
                        <div id="oneHourFilters" class="mt-2 d-none">
                            <!-- Previous Day Close -->
                            <div class="mb-2">
                                <label class="form-label small">Previous Day Close</label>
                                <select class="form-select form-select-sm" id="prevDayClose">
                                    <option value="">Any</option>
                                    <option value="strong_bullish">Strong Bullish</option>
                                    <option value="strong_bearish">Strong Bearish</option>
                                </select>
                            </div>
                            
                            <!-- Flat Opening -->
                            <div class="mb-2">
                                <label class="form-label small">Flat Opening Tolerance</label>
                                <div class="row">
                                    <div class="col-6">
                                        <input type="number" class="form-control form-control-sm" id="stockFlatTolerance" 
                                               placeholder="Stock %" value="1" step="0.1" min="0" max="5">
                                        <small class="text-muted">Stock %</small>
                                    </div>
                                    <div class="col-6">
                                        <input type="number" class="form-control form-control-sm" id="indexFlatTolerance" 
                                               placeholder="Index pts" value="30" step="5" min="0" max="200">
                                        <small class="text-muted">Index pts</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- High Liquidity Filter -->
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="highLiquidity" checked>
                                <label class="form-check-label small" for="highLiquidity">
                                    High Liquidity (Nifty 50/F&O)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>Scan Stocks
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="resetFilters()">
                            <i class="fas fa-refresh me-1"></i>Reset
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scanner Results -->
    <div class="col-lg-9 mb-4">
        <div class="card h-100">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>Scan Results
                </h5>
                <div class="d-flex align-items-center gap-2">
                    <span id="resultCount" class="badge bg-light text-dark">0 stocks found</span>
                    <button id="downloadCsvBtn" class="btn btn-sm btn-outline-light d-none" onclick="downloadCSV()" title="Download results as CSV">
                        <i class="fas fa-download me-1"></i>CSV
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="loadingSpinner" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Scanning stocks...</p>
                </div>

                <div id="scanResults">
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-search fa-3x mb-3"></i>
                        <h5>Ready to Scan</h5>
                        <p>Set your filters and click "Scan Stocks" to find matching securities</p>
                    </div>
                </div>

                <!-- Results Table (will be populated by JavaScript) -->
                <div id="resultsTable" class="d-none">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Symbol</th>
                                    <th>Price</th>
                                    <th>Change %</th>
                                    <th>Volume</th>
                                    <th>RSI</th>
                                    <th>Pattern</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <!-- Results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Scan Presets -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bolt me-2"></i>Quick Scan Presets
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-primary w-100" onclick="applyPreset('momentum')">
                            <i class="fas fa-rocket me-1"></i>Momentum Stocks
                        </button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-success w-100" onclick="applyPreset('oversold')">
                            <i class="fas fa-arrow-down me-1"></i>Oversold Stocks
                        </button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-danger w-100" onclick="applyPreset('overbought')">
                            <i class="fas fa-arrow-up me-1"></i>Overbought Stocks
                        </button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-info w-100" onclick="applyPreset('breakout')">
                            <i class="fas fa-chart-line me-1"></i>Breakout Stocks
                        </button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-warning w-100" onclick="applyPreset('oneHourSetup')">
                            <i class="fas fa-clock me-1"></i>One Hour Setup
                        </button>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button class="btn btn-outline-secondary w-100" onclick="showPaperTrading()">
                            <i class="fas fa-chart-area me-1"></i>Paper Trading
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const scannerForm = document.getElementById('scannerForm');
    const oneHourSetup = document.getElementById('oneHourSetup');
    const oneHourFilters = document.getElementById('oneHourFilters');
    
    // Toggle One Hour Setup filters
    oneHourSetup.addEventListener('change', function() {
        if (this.checked) {
            oneHourFilters.classList.remove('d-none');
        } else {
            oneHourFilters.classList.add('d-none');
        }
    });
    
    scannerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        performScan();
    });
});

function performScan() {
    const loadingSpinner = document.getElementById('loadingSpinner');
    const scanResults = document.getElementById('scanResults');
    const resultsTable = document.getElementById('resultsTable');
    const resultCount = document.getElementById('resultCount');
    
    // Show loading
    loadingSpinner.classList.remove('d-none');
    scanResults.classList.add('d-none');
    resultsTable.classList.add('d-none');
    
    // Collect form data
    const formData = {
        segment: document.getElementById('segment').value,
        minPrice: document.getElementById('minPrice').value,
        maxPrice: document.getElementById('maxPrice').value,
        minVolume: document.getElementById('minVolume').value,
        marketCap: document.getElementById('marketCap').value,
        bullishPattern: document.getElementById('bullishPattern').checked,
        bearishPattern: document.getElementById('bearishPattern').checked,
        breakoutPattern: document.getElementById('breakoutPattern').checked,
        minRSI: document.getElementById('minRSI').value,
        maxRSI: document.getElementById('maxRSI').value,
        oneHourSetup: document.getElementById('oneHourSetup').checked,
        prevDayClose: document.getElementById('prevDayClose')?.value || '',
        stockFlatTolerance: document.getElementById('stockFlatTolerance')?.value || 1,
        indexFlatTolerance: document.getElementById('indexFlatTolerance')?.value || 30,
        highLiquidity: document.getElementById('highLiquidity')?.checked || false
    };
    
    // Store scan data for CSV export
    currentScanData = formData;
    
    // Make real API call to backend scanner endpoint
    fetch('/api/scanner', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            console.error('Scanner error:', data.error);
            alert('Scanner error: ' + data.error);
            loadingSpinner.classList.add('d-none');
            return;
        }
        
        displayResults(data.results || [], formData.oneHourSetup);
        loadingSpinner.classList.add('d-none');
        
        // Show CSV download button if results exist
        const downloadBtn = document.getElementById('downloadCsvBtn');
        if (data.results && data.results.length > 0) {
            downloadBtn.classList.remove('d-none');
        } else {
            downloadBtn.classList.add('d-none');
        }
    })
    .catch(error => {
        console.error('Scanner request failed:', error);
        alert('Scanner request failed. Please try again.');
        loadingSpinner.classList.add('d-none');
    });
}

// Global variable to store current scan data for CSV export
let currentScanData = null;

function downloadCSV() {
    if (!currentScanData) {
        alert('No scan data available. Please run a scan first.');
        return;
    }
    
    // Show loading state
    const downloadBtn = document.getElementById('downloadCsvBtn');
    const originalText = downloadBtn.innerHTML;
    downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Downloading...';
    downloadBtn.disabled = true;
    
    // Make API call to export CSV
    fetch('/api/scanner/export-csv', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(currentScanData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('CSV export failed');
        }
        return response.blob();
    })
    .then(blob => {
        // Create download link
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        
        // Get filename from response headers or generate one
        const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
        const scanType = currentScanData.oneHourSetup ? 'OneHourSetup' : 'RegularScan';
        a.download = `scanner_results_${scanType}_${timestamp}.csv`;
        
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        // Reset button state
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
    })
    .catch(error => {
        console.error('CSV download failed:', error);
        alert('CSV download failed. Please try again.');
        
        // Reset button state
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
    });
}

function displayResults(results, isOneHourSetup = false) {
    const resultsTable = document.getElementById('resultsTable');
    const resultsBody = document.getElementById('resultsBody');
    const resultCount = document.getElementById('resultCount');
    const tableHead = resultsTable.querySelector('thead tr');
    
    resultCount.textContent = `${results.length} stocks found`;
    
    // Update table headers for One Hour Setup
    if (isOneHourSetup) {
        tableHead.innerHTML = `
            <th>Symbol</th>
            <th>Price</th>
            <th>Change %</th>
            <th>Volume</th>
            <th>Prev Close</th>
            <th>Signal</th>
            <th>Action</th>
        `;
    } else {
        tableHead.innerHTML = `
            <th>Symbol</th>
            <th>Price</th>
            <th>Change %</th>
            <th>Volume</th>
            <th>RSI</th>
            <th>Pattern</th>
            <th>Action</th>
        `;
    }
    
    // Clear previous results
    resultsBody.innerHTML = '';
    
    // Populate results
    results.forEach(stock => {
        const row = document.createElement('tr');
        const changeClass = stock.change >= 0 ? 'text-success' : 'text-danger';
        const changeIcon = stock.change >= 0 ? 'fa-arrow-up' : 'fa-arrow-down';
        
        if (isOneHourSetup) {
            const signalClass = stock.signal === 'Setup Ready' ? 'bg-success' : 'bg-warning';
            // Determine prevClose color based on bullish/bearish
            const prevCloseClass = stock.prevClose.includes('Bullish') ? 'bg-success' : 
                                  stock.prevClose.includes('Bearish') ? 'bg-danger' : 'bg-info';
            row.innerHTML = `
                <td><strong>${stock.symbol}</strong></td>
                <td>Rs.${stock.price.toFixed(2)}</td>
                <td class="${changeClass}">
                    <i class="fas ${changeIcon} me-1"></i>${stock.change.toFixed(2)}%
                </td>
                <td>${stock.volume.toLocaleString()}</td>
                <td><span class="badge ${prevCloseClass}">${stock.prevClose}</span></td>
                <td><span class="badge ${signalClass}">${stock.signal}</span></td>
                <td>
                    <button class="btn btn-sm btn-primary me-1" onclick="openChart('${stock.symbol}', 'One Hour Setup')">
                        <i class="fas fa-chart-line me-1"></i>Chart
                    </button>
                    <button class="btn btn-sm btn-success" onclick="executeTrade('${stock.symbol}', '${stock.prevClose}')">
                        <i class="fas fa-play me-1"></i>Trade
                    </button>
                </td>
            `;
        } else {
            row.innerHTML = `
                <td><strong>${stock.symbol}</strong></td>
                <td>Rs.${stock.price.toFixed(2)}</td>
                <td class="${changeClass}">
                    <i class="fas ${changeIcon} me-1"></i>${stock.change.toFixed(2)}%
                </td>
                <td>${stock.volume.toLocaleString()}</td>
                <td>${stock.rsi}</td>
                <td><span class="badge bg-info">${stock.pattern}</span></td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-2" onclick="openChart('${stock.symbol}', 'One Hour Setup')">
                        <i class="fas fa-chart-line"></i> Chart
                    </button>
                </td>
            `;
        }
        resultsBody.appendChild(row);
    });
    
    resultsTable.classList.remove('d-none');
}

function resetFilters() {
    document.getElementById('scannerForm').reset();
    document.getElementById('oneHourFilters').classList.add('d-none');
    document.getElementById('scanResults').innerHTML = `
        <div class="text-center text-muted py-5">
            <i class="fas fa-search fa-3x mb-3"></i>
            <h5>Ready to Scan</h5>
            <p>Set your filters and click "Scan Stocks" to find matching securities</p>
        </div>
    `;
    document.getElementById('resultsTable').classList.add('d-none');
    document.getElementById('resultCount').textContent = '0 stocks found';
}

function applyPreset(presetType) {
    resetFilters();
    
    switch(presetType) {
        case 'momentum':
            document.getElementById('minVolume').value = '100000';
            document.getElementById('minRSI').value = '60';
            document.getElementById('maxRSI').value = '80';
            document.getElementById('bullishPattern').checked = true;
            break;
        case 'oversold':
            document.getElementById('maxRSI').value = '30';
            break;
        case 'overbought':
            document.getElementById('minRSI').value = '70';
            break;
        case 'breakout':
            document.getElementById('minVolume').value = '200000';
            document.getElementById('breakoutPattern').checked = true;
            break;
        case 'oneHourSetup':
            document.getElementById('oneHourSetup').checked = true;
            document.getElementById('oneHourFilters').classList.remove('d-none');
            document.getElementById('highLiquidity').checked = true;
            document.getElementById('segment').value = 'NSE';
            document.getElementById('minVolume').value = '500000';
            break;
    }
    
    // Auto-run scan after applying preset
    performScan();
}

// Chart functionality is now handled by the chart_modal.html component
// The openChart function is defined in chart_modal.html

// Update risk amount when quantity or prices change
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('tradeExecutionModal');
    if (modal) {
        const quantityInput = document.getElementById('execQuantity');
        const entryInput = document.getElementById('execEntryPrice');
        const stopLossInput = document.getElementById('execStopLoss');
        const riskAmountInput = document.getElementById('execRiskAmount');
        
        function updateRiskAmount() {
            const quantity = parseFloat(quantityInput.value) || 0;
            const entry = parseFloat(entryInput.value) || 0;
            const stopLoss = parseFloat(stopLossInput.value) || 0;
            const riskPerShare = Math.abs(entry - stopLoss);
            const totalRisk = quantity * riskPerShare;
            riskAmountInput.value = totalRisk.toFixed(2);
        }
        
        quantityInput.addEventListener('input', updateRiskAmount);
        entryInput.addEventListener('input', updateRiskAmount);
        stopLossInput.addEventListener('input', updateRiskAmount);
    }
});

// Chart functionality is now handled by the openChart function in chart_modal.html

function executeTrade(symbol, prevClose) {
    // Get current price and setup trade parameters
    const currentPrice = 2456.75; // Mock price - replace with real data
    
    // Determine trade type based on signal
    let tradeType, entryPrice, stopLoss, target;
    
    if (prevClose === 'Strong Bearish') {
        tradeType = 'SELL';
        entryPrice = currentPrice;
        stopLoss = currentPrice * 1.02; // 2% above entry
        target = currentPrice * 0.96; // 4% below entry (1:2 ratio)
    } else if (prevClose === 'Strong Bullish') {
        tradeType = 'BUY';
        entryPrice = currentPrice;
        stopLoss = currentPrice * 0.98; // 2% below entry
        target = currentPrice * 1.04; // 4% above entry (1:2 ratio)
    } else {
        alert('Invalid signal for trade execution');
        return;
    }
    
    // Calculate suggested quantity based on risk management
    const riskAmount = 1000; // Rs.1000 risk per trade
    const riskPerShare = Math.abs(entryPrice - stopLoss);
    const suggestedQty = Math.floor(riskAmount / riskPerShare);
    
    // Populate modal with trade data
    document.getElementById('execSymbol').value = symbol;
    document.getElementById('execTradeType').value = tradeType;
    document.getElementById('execQuantity').value = suggestedQty;
    document.getElementById('execEntryPrice').value = entryPrice.toFixed(2);
    document.getElementById('execStopLoss').value = stopLoss.toFixed(2);
    document.getElementById('execTarget').value = target.toFixed(2);
    document.getElementById('execRiskAmount').value = (riskPerShare * suggestedQty).toFixed(2);
    
    // Store trade data for modal access
    window.currentTradeData = {
        symbol: symbol,
        type: tradeType,
        quantity: suggestedQty,
        entryPrice: entryPrice,
        stopLoss: stopLoss,
        target: target,
        strategy: 'One Hour Setup',
        prevClose: prevClose
    };
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('tradeExecutionModal'));
    modal.show();
}

function confirmTradeExecution() {
    const tradeData = {
        ...window.currentTradeData,
        quantity: parseInt(document.getElementById('execQuantity').value),
        entryPrice: parseFloat(document.getElementById('execEntryPrice').value),
        stopLoss: parseFloat(document.getElementById('execStopLoss').value),
        target: parseFloat(document.getElementById('execTarget').value),
        timestamp: new Date().toISOString()
    };
    
    // Store in localStorage for paper trading tracking
    let paperTrades = JSON.parse(localStorage.getItem('paperTrades') || '[]');
    paperTrades.push(tradeData);
    localStorage.setItem('paperTrades', JSON.stringify(paperTrades));
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('tradeExecutionModal'));
    modal.hide();
    
    alert(`Paper trade executed for ${tradeData.symbol} (${tradeData.type})\nEntry: Rs.${tradeData.entryPrice.toFixed(2)}\nMonitoring for entry signal...`);
}

function showPaperTrading() {
    const paperTrades = JSON.parse(localStorage.getItem('paperTrades') || '[]');
    
    if (paperTrades.length === 0) {
        alert('No paper trades found. Execute some trades first!');
        return;
    }
    
    let tradeHistory = 'Paper Trading Portfolio:\n\n';
    let totalPnL = 0;
    
    paperTrades.forEach((trade, index) => {
        const currentPrice = trade.entryPrice + (Math.random() - 0.5) * trade.entryPrice * 0.05; // Mock current price
        const pnl = trade.type === 'BUY' ? 
            (currentPrice - trade.entryPrice) * trade.quantity :
            (trade.entryPrice - currentPrice) * trade.quantity;
        
        totalPnL += pnl;
        
        tradeHistory += `${index + 1}. ${trade.symbol} (${trade.type})\n`;
        tradeHistory += `   Entry: Rs.${trade.entryPrice.toFixed(2)} | Current: Rs.${currentPrice.toFixed(2)}\n`;
        tradeHistory += `   P&L: Rs.${pnl.toFixed(2)} | Qty: ${trade.quantity}\n`;
        tradeHistory += `   Date: ${new Date(trade.timestamp).toLocaleDateString()}\n\n`;
    });
    
    tradeHistory += `Total P&L: Rs.${totalPnL.toFixed(2)}`;
    
    alert(tradeHistory);
}
</script>

<!-- Trade Execution Modal -->
<div class="modal fade" id="tradeExecutionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Execute One Hour Setup Trade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>One Hour Setup Strategy:</strong> Wait for opposite color candle formation, then enter on breakout with 1:2 risk-reward ratio.
                </div>
                
                <form id="tradeExecutionForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Symbol</label>
                                <input type="text" class="form-control" id="execSymbol" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Trade Type</label>
                                <select class="form-select" id="execTradeType" disabled>
                                    <option value="BUY">Buy (Long)</option>
                                    <option value="SELL">Sell (Short)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="execQuantity">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Entry Price</label>
                                <input type="number" step="0.01" class="form-control" id="execEntryPrice">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Risk Amount</label>
                                <input type="number" step="0.01" class="form-control" id="execRiskAmount" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Stop Loss</label>
                                <input type="number" step="0.01" class="form-control" id="execStopLoss">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Target Price</label>
                                <input type="number" step="0.01" class="form-control" id="execTarget">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Strategy</label>
                        <input type="text" class="form-control" id="execStrategy" value="One Hour Setup" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="confirmTradeExecution()">
                    <i class="fas fa-chart-line me-1"></i>Execute Paper Trade
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}